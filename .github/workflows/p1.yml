name: p1

on:
  schedule:
    - cron: "0 */12 * * *"  # Her 12 saatte bir
  workflow_dispatch:        # Manuel tetikleme için

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Repo dosyalarını al
        uses: actions/checkout@v3

      - name: Python kurulumu
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'  # Uyumlu sürüm

      - name: Gerekli kütüphaneleri kur
        run: |
          python -m pip install --upgrade pip
          pip install requests
          pip install cryptography
          
      # - name: Betiği çalıştır
        # run: python ressources/xttsearch/p1.py
        
      - name: Betiği çalıştır
        run: python ressources/xttsearch/p1.py
          
      - name: Commit and Push changes
        env:
          GH_PAT: ${{ secrets.GH_PAT }}  # TOKEN BURADA DEĞİŞTİRİLDİ
        run: |
          git add ressources/xttsearch/p1.xml
          git add ressources/xttsearch/p1.xml.gz
          git commit -m "p1 updated" || echo "No changes to commit"
          git remote set-url origin https://x-access-token:${GH_PAT}@github.com/${{ github.repository }}
          git push origin main


      - name: .xml dosyasını kontrol et ve sil
        env:
          GH_PAT: ${{ secrets.GH_PAT }}  # TOKEN BURADA DEĞİŞTİRİLDİ
        run: |
          if [ -f "ressources/xttsearch/p1.xml" ]; then
            echo "ressources/xttsearch/p1.xml bulundu. Siliniyor..."
            rm ressources/xttsearch/p1.xml
            git remote set-url origin https://x-access-token:${GH_PAT}@github.com/${{ github.repository }}
          else
            echo "ressources/xttsearch/p1.xml bulunamadı, atlanıyor."
          fi